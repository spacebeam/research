<!DOCTYPE html>
<html lang="en">
<head>
          <title>Spacebeam: Distributed Artificial Intelligence</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta charset="utf-8" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Spacebeam: Distributed Artificial Intelligence Full Atom Feed" />
        <link href="/feeds/updates.atom.xml" type="application/atom+xml" rel="alternate" title="Spacebeam: Distributed Artificial Intelligence Categories Atom Feed" />
        <!-- twitter card metadata -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/logo.png">
<meta name="twitter:site" content="@SpacebeamOrg">
<meta name="twitter:title" content="Stage 2 Supervision">
<meta name="twitter:description" content="A collection of tools for managing UNIX services.. Supervision means the system will restart the process immediately if it crash for some reason!">
        <!-- OG Tags -->
<meta property="og:url" content="/2020/07/06/stage-2-supervision/"/>
<meta property="og:title" content="Spacebeam: Distributed Artificial Intelligence | Stage 2 Supervision" />
<meta property="og:description" content="A collection of tools for managing UNIX services.. Supervision means the system will restart the process immediately if it crash for some reason!" />
        <!-- favicon -->
        <link rel="icon" type="image/png" href="/images/logo.png">
        <!-- moment.js for date formatting -->
        <script src="/theme/js/moment.js"></script>
        <!-- css -->
        <link rel="stylesheet" type="text/css" href="/theme/css/main.css" />
		<script>
			
                /*! grunt-grunticon Stylesheet Loader - v2.1.2 | https://github.com/filamentgroup/grunticon | (c) 2015 Scott Jehl, Filament Group, Inc. | MIT license. */
    
    (function(e){function t(t,n,r,o){"use strict";function a(){for(var e,n=0;u.length>n;n++)u[n].href&&u[n].href.indexOf(t)>-1&&(e=!0);e?i.media=r||"all":setTimeout(a)}var i=e.document.createElement("link"),l=n||e.document.getElementsByTagName("script")[0],u=e.document.styleSheets;return i.rel="stylesheet",i.href=t,i.media="only x",i.onload=o||null,l.parentNode.insertBefore(i,l),a(),i}var n=function(r,o){"use strict";if(r&&3===r.length){var a=e.navigator,i=e.Image,l=!(!document.createElementNS||!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect||!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1")||e.opera&&-1===a.userAgent.indexOf("Chrome")||-1!==a.userAgent.indexOf("Series40")),u=new i;u.onerror=function(){n.method="png",n.href=r[2],t(r[2])},u.onload=function(){var e=1===u.width&&1===u.height,a=r[e&&l?0:e?1:2];n.method=e&&l?"svg":e?"datapng":"png",n.href=a,t(a,null,null,o)},u.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",document.documentElement.className+=" grunticon"}};n.loadCSS=t,e.grunticon=n})(this);(function(e,t){"use strict";var n=t.document,r="grunticon:",o=function(e){if(n.attachEvent?"complete"===n.readyState:"loading"!==n.readyState)e();else{var t=!1;n.addEventListener("readystatechange",function(){t||(t=!0,e())},!1)}},a=function(e){return t.document.querySelector('link[href$="'+e+'"]')},c=function(e){var t,n,o,a,c,i,u={};if(t=e.sheet,!t)return u;n=t.cssRules?t.cssRules:t.rules;for(var l=0;n.length>l;l++)o=n[l].cssText,a=r+n[l].selectorText,c=o.split(");")[0].match(/US\-ASCII\,([^"']+)/),c&&c[1]&&(i=decodeURIComponent(c[1]),u[a]=i);return u},i=function(e){var t,o,a;o="data-grunticon-embed";for(var c in e)if(a=c.slice(r.length),t=n.querySelectorAll(a+"["+o+"]"),t.length)for(var i=0;t.length>i;i++)t[i].innerHTML=e[c],t[i].style.backgroundImage="none",t[i].removeAttribute(o);return t},u=function(t){"svg"===e.method&&o(function(){i(c(a(e.href))),"function"==typeof t&&t()})};e.embedIcons=i,e.getCSS=a,e.getIcons=c,e.ready=o,e.svgLoadedCallback=u,e.embedSVG=u})(grunticon,this);
                
                grunticon(["/theme/css/icons.data.svg.css", "/theme/css/icons.data.png.css", "/theme/css/icons.fallback.css"]);
            </script>
        <noscript><link href="/theme/css/icons.fallback.css" rel="stylesheet"></noscript>
        <!-- menu toggle javascript -->
        <script type="text/javascript">
            document.addEventListener("DOMContentLoaded", initMenu);
            
            function initMenu(){
                var menu = document.getElementById("menu");
                var menulink = document.getElementById("menu-link");
                menulink.addEventListener("click", function toggleMenu(){
                        window.event.preventDefault();
                        menulink.classList.toggle('active');
                        menu.classList.toggle('active');              
                    });
            };
        </script>

    <meta name="description" content="A collection of tools for managing UNIX services.. Supervision means the system will restart the process immediately if it crash for some reason!" />


</head>
<body>
    <div role="banner" id="masthead">
        <header>
            <a href="/"><img src="/images/logo.png" alt="McManus Logo"></a>
            <a href="#menu" id="menu-link">more stuff</a>
            <nav id="menu">
                <ul>
                        <li><a href="/pages/about/">about</a></li>
                        <li><a href="/pages/research/">research</a></li>
                        <li><a href="/pages/technology/">technology</a></li>
                            <li class="active"><a href="/category/updates">updates</a></li>
                </ul>
            </nav>
        </header>
    </div>
        <div class="page" role="main">
  <div class="article" role="article">
    <article>
        <footer>
            <a name="top"></a>
            <p>
              <time datetime=" 2020-07-06 00:00:00+02:00">
                <script>document.write(moment('2020-07-06 00:00:00+02:00').format('LL'));</script>
              </time>
            </p>
        </footer>
        <header>
          <h2>
            Stage 2 Supervision
          </h2>
        </header>
      <div class="content">
         <p>At its core, <code>runit</code> is a process supervision suite.</p>
<p>The concept of process supervision comes from several observations:</p>
<ul>
<li>UNIX systems, even minimalistic ones, need to run long-lived processes, aka daemons.</li>
</ul>
<p>That one is the core design principle of UNIX: one service -&gt; one daemon.</p>
<ul>
<li>Daemons can die at all times. Maybe they are missing a vital resource and cannot handle certain failure;</li>
<li>Automatically restarting daemons when they die is generally a good thing.</li>
</ul>
<p>A process supervsion system organizes the process hierarchy in a radical different way.</p>
<ul>
<li>A process supervision system starts independen hierarchy of processes at boot time, called a supervision tree.</li>
<li>Your daemon is identified by the specific directory which contains all the information about it; then you send a message to the supervision tree. The supervision tree start the daemon as a leaf.</li>
<li>The parent of your daemon is a supervisor. Since your daemon is its direct child, the supervisor always knows the correct PID of your daemon.</li>
<li>To send signals to your daemons, you send a message to its supervisor, which will then send the signal to the daemon in your behalf.</li>
</ul>
<p>The design of <code>runit</code> takes a very familiar approach by breaking down functionality into several small utilities
responsible for a single task. This approach allows the simple components to be composed in various ways to suit
our needs. The core runit utilities are <code>runsvdir</code>, <code>runsv</code>, <code>chpst</code>, <code>svlogd</code>, and <code>sv</code>.</p>
<h2>Service supervision</h2>
<p>Each service is associated with a service directory, and each service daemon runs as a child process of a supervising <code>runsv</code> process runing in this directory.</p>
<p>The <code>runsv</code> program provides a reliable interface for signalling the service daemon and controlling the service and supervisor.</p>
<p>Normally the <code>sv</code> program is used to send commands throught this interface, and to query status information about the service.</p>
<p>The <code>runsv</code> program supervises the corresponding service daemon. By default a service is defined to be up, that means, if the service daemon dies, will be restarted. Of course you can tell it otherwise.</p>
<p>The promise is that this reliable interface to control daemons and supervisors obsolete pid-guessing programs, such as pidoff, killall, start-stop-daemon, which, due to guessing are prone to failures by design.</p>
<p>It also obsoletes so called pid-files, no need for each and every service daemon to include code to daemonize, to write the new process id into a file, and to take care that file is removed properly on shutdown, which might be very difficult in case of a crash!</p>
<h2>Clean process state</h2>
<p><code>runit</code> guarantees each service a clean process state, no matter if the service is activated for the first time or automatically at boot time, reactivated, or simply restarted. This means that the service always is started with the same environment, resource limits, open file descriptors, and controlling terminals.</p>
<h2>Reliable logging facility</h2>
<p>The <code>runsv</code> program provides a reliable logging facility for the service daemon. If configured, <code>runsv</code> creates a pipe, starts and supervises an additional log service, redirects the log daemon's standard input to read from the pipe, and redirects the service daemon's standard output to write to the pipe.</p>
<p>Restarting the service does not require restarting the log service, and vice versa.</p>
<p>A good choice for log daemon is runit's service logging daemon <code>svlogd</code>.</p>
<p>The service daemon and log daemon run with different process statesm and can run under different user id's.</p>
<p><code>runit</code> supports easy and realiable logging for service daemons running inside <a href="https://github.com/hpcng/singularity">singularity</a> containers.</p>
<h2>Stage 2</h2>
<p>Stage 2 handles the systems's uptime tasks (via the <code>runsvdir</code> program) and is running the whole system's uptime life spawn.</p>
<p>Stage 2 is portable across UNIX systems. <code>runit</code> is well suited for <a href="https://news.ycombinator.com/item?id=19193572">tesla</a> ev's, servers and embedded systems, and also does its job well on everyday working environments.</p>
<p>Stage 2 is packaging friendly:</p>
      </div>
      <div class="back-to-top">
          <a href="#top">back to top</a>
      </div>
      <div id="disqus_thread"></div>
        <script>
        (function() {
              var d = document, s = d.createElement('script');
              s.src = 'https://spacebeam.disqus.com/embed.js';
              s.setAttribute('data-timestamp', +new Date());
              (d.head || d.body).appendChild(s);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </article>
  </div>
<!-- end article -->
                <footer>
                    <div class="icons">
                        <a href="https://twitter.com/SpacebeamOrg" target="_blank"><div class="icon-twitter icon"></div></a>
                        <a href="https://github.com/spacebeam" target="_blank"><div class="icon-github icon"></div></a>
                    </div>
                    <p>Â© <script>document.write(moment().format('YYYY'));</script> Spacebeam Community</p>
                </footer>
        </div>
</body>
</html>